#!/usr/bin/osascript
(* Copyright (c) 2020 Xvezda <xvezda@naver.com>

Use of this source code is governed by an MIT-style
license that can be found in the LICENSE file or at
https://opensource.org/licenses/MIT.

*)

set userCancelCode to -128

-- ì‘ì—… ë³µì›ì´ ê°€ëŠ¥í•˜ë„ë¡ íœ´ì§€í†µì„ ì‚­ì œí•¨ìˆ˜ë¡œ ì‚¬ìš©
on trashFile from paths as list
    set posixFilePaths to {}
    repeat with p in paths
        set end of posixFilePaths to (POSIX file p)
    end repeat
    tell application "Finder" to delete every item of posixFilePaths
end trashFile


--ì¹´ì¹´ì˜¤í†¡ì´ ì‹¤í–‰ì¤‘ì´ë©´ ì•Œë¦¼ì°½ì„ ë„ìš°ê³  ì¢…ë£Œ {{{1
set appName to "KakaoTalk"
if application appName is running then
    try
        set dialogResult to display dialog Â¬
            "ì•ˆì •ì ì¸ ë™ì‘ì„ ìœ„í•´ ì¹´ì¹´ì˜¤í†¡ì´ ì¢…ë£Œëœ ìƒíƒœë¡œ " Â¬
            & "ì§„í–‰í•˜ì‹œëŠ”ê²ƒì„ ê¶Œì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤." & return & return Â¬
            & "ì¹´ì¹´ì˜¤í†¡ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" Â¬
            with icon stop Â¬
            with title "ì¹´ì¹´ì˜¤í†¡ì´ ì‹¤í–‰ì¤‘ì…ë‹ˆë‹¤."
        -- OK ë²„íŠ¼ì„ ëˆ„ë¥¸ê²½ìš° ì¹´ì¹´ì˜¤í†¡ì„ ì¢…ë£Œ
        if button returned of dialogResult is "OK" then
            tell application appName to quit
        end if
    on error number userCancelCode
        -- ì·¨ì†Œë¥¼ ëˆ„ë¥¼ê²½ìš° ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
    end try
end if -- 1}}}

-- ë¡œê·¸ì¸ì´ ë˜ì§€ ì•ŠëŠ”í˜„ìƒ í•´ê²° {{{1
set homePath to system attribute "HOME"
set pkgName to "com.kakao.KakaoTalkMac"
set libPath to homePath & "/Library"
set pkgPath to libPath & "/Containers/" & pkgName
set pkgLib to pkgPath & "/Data/Library"

set filesToTrash to {}

-- ì„¤ì •íŒŒì¼ ì‚­ì œ {{{2
set prefPath to pkgLib & "/Preferences"
tell application "System Events"
    set prefFiles to every file of folder prefPath
    repeat with prefFile in prefFiles
        set prefFileName to (name of prefFile as string)
        if prefFileName starts with pkgName then
            -- my trashFile from prefFile
            set end of filesToTrash to (POSIX path of prefFile)
        end if
    end repeat
end tell -- 2}}}

-- ìºì‹œíŒŒì¼ ì‚­ì œ {{{2
set cachePath to pkgLib & "/Caches"
set end of filesToTrash to cachePath
-- 2}}}
-- 1}}}


-- ì´ˆê¸°í™”ë©´(ì¹œêµ¬ëª©ë¡)ì—ì„œ í”„ë¦¬ì§•ë˜ëŠ” í˜„ìƒí•´ê²° {{{1
set end of filesToTrash to do shell script "find " Â¬
    & quoted form of (pkgLib & "/Application Support/" & pkgName) Â¬
    & " -type f -maxdepth 1 -regex '.*/[0-9a-z]*'"
-- 1}}}

-- íŒŒì¼ ì‚­ì œ
-- repeat with f in filesToTrash
--     display dialog f buttons "OK"
-- end repeat
trashFile from filesToTrash

display alert "ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰"

